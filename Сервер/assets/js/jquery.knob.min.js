/*jQuery Knob*/
(function(a){var b={},c=Math.max,d=Math.min;b.c={};b.c.d=a(document);b.c.t=function(f){return f.originalEvent.touches.length-1};b.o=function(){var e=this;this.o=null;this.$=null;this.i=null;this.g=null;this.v=null;this.cv=null;this.x=0;this.y=0;this.$c=null;this.c=null;this.t=0;this.isInit=false;this.fgColor=null;this.pColor=null;this.dH=null;this.cH=null;this.eH=null;this.rH=null;this.run=function(){var f=function(h,g){var i;for(i in g){e.o[i]=g[i]}e.init();e._configure()._draw()};if(this.$.data("kontroled")){return}this.$.data("kontroled",true);this.extend();this.o=a.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,stopper:true,readOnly:this.$.data("readonly"),cursor:(this.$.data("cursor")===true&&30)||this.$.data("cursor")||0,thickness:this.$.data("thickness")||0.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:this.$.data("displayinput")==null||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor")||this.$.data("fgcolor")||"#87CEEB",inline:false,step:this.$.data("step")||1,draw:null,change:null,cancel:null,release:null},this.o);if(this.$.is("fieldset")){this.v={};this.i=this.$.find("input");this.i.each(function(h){var g=a(this);e.i[h]=g;e.v[h]=g.val();g.bind("change",function(){var i={};i[h]=g.val();e.val(i)})});this.$.find("legend").remove()}else{this.i=this.$;this.v=this.$.val();(this.v=="")&&(this.v=this.o.min);this.$.bind("change",function(){e.val(e._validate(e.$.val()))})}(!this.o.displayInput)&&this.$.hide();this.$c=a('<canvas width="'+this.o.width+'px" height="'+this.o.height+'px"></canvas>');this.c=this.$c[0].getContext("2d");this.$.wrap(a('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>')).before(this.$c);if(this.v instanceof Object){this.cv={};this.copy(this.v,this.cv)}else{this.cv=this.v}this.$.bind("configure",f).parent().bind("configure",f);this._listen()._configure()._xy().init();this.isInit=true;this._draw();return this};this._draw=function(){var g=true,f=document.createElement("canvas");f.width=e.o.width;f.height=e.o.height;e.g=f.getContext("2d");e.clear();e.dH&&(g=e.dH());(g!==false)&&e.draw();e.c.drawImage(f,0,0);f=null};this._touch=function(f){var g=function(h){var i=e.xy2val(h.originalEvent.touches[e.t].pageX,h.originalEvent.touches[e.t].pageY);if(i==e.cv){return}if(e.cH&&(e.cH(i)===false)){return}e.change(e._validate(i));e._draw()};this.t=b.c.t(f);g(f);b.c.d.bind("touchmove.k",g).bind("touchend.k",function(){b.c.d.unbind("touchmove.k touchend.k");if(e.rH&&(e.rH(e.cv)===false)){return}e.val(e.cv)});return this};this._mouse=function(f){var g=function(h){var i=e.xy2val(h.pageX,h.pageY);if(i==e.cv){return}if(e.cH&&(e.cH(i)===false)){return}e.change(e._validate(i));e._draw()};g(f);b.c.d.bind("mousemove.k",g).bind("keyup.k",function(h){if(h.keyCode===27){b.c.d.unbind("mouseup.k mousemove.k keyup.k");if(e.eH&&(e.eH()===false)){return}e.cancel()}}).bind("mouseup.k",function(h){b.c.d.unbind("mousemove.k mouseup.k keyup.k");if(e.rH&&(e.rH(e.cv)===false)){return}e.val(e.cv)});return this};this._xy=function(){var f=this.$c.offset();this.x=f.left;this.y=f.top;return this};this._listen=function(){if(!this.o.readOnly){this.$c.bind("mousedown",function(f){f.preventDefault();e._xy()._mouse(f)}).bind("touchstart",function(f){f.preventDefault();e._xy()._touch(f)});this.listen()}else{this.$.attr("readonly","readonly")}return this};this._configure=function(){if(this.o.draw){this.dH=this.o.draw}if(this.o.change){this.cH=this.o.change}if(this.o.cancel){this.eH=this.o.cancel}if(this.o.release){this.rH=this.o.release}if(this.o.displayPrevious){this.pColor=this.h2rgba(this.o.fgColor,"0.4");this.fgColor=this.h2rgba(this.o.fgColor,"0.6")}else{this.fgColor=this.o.fgColor}return this};this._clear=function(){this.$c[0].width=this.$c[0].width};this._validate=function(f){return(~~(((f<0)?-0.5:0.5)+(f/this.o.step)))*this.o.step};this.listen=function(){};this.extend=function(){};this.init=function(){};this.change=function(f){};this.val=function(f){};this.xy2val=function(f,g){};this.draw=function(){};this.clear=function(){this._clear()};this.h2rgba=function(g,f){var i;g=g.substring(1,7);i=[parseInt(g.substring(0,2),16),parseInt(g.substring(2,4),16),parseInt(g.substring(4,6),16)];return"rgba("+i[0]+","+i[1]+","+i[2]+","+f+")"};this.copy=function(g,j){for(var h in g){j[h]=g[h]}}};b.Dial=function(){b.o.call(this);this.startAngle=null;this.xy=null;this.radius=null;this.lineWidth=null;this.cursorExt=null;this.w2=null;this.PI2=2*Math.PI;this.extend=function(){this.o=a.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:true},this.o)};this.val=function(e){if(null!=e){this.cv=this.o.stopper?c(d(e,this.o.max),this.o.min):e;this.v=this.cv;this.$.val(this.v);this._draw()}else{return this.v}};this.xy2val=function(g,h){var e,f;e=Math.atan2(g-(this.x+this.w2),-(h-this.y-this.w2))-this.angleOffset;if(this.angleArc!=this.PI2&&(e<0)&&(e>-0.5)){e=0}else{if(e<0){e+=this.PI2}}f=~~(0.5+(e*(this.o.max-this.o.min)/this.angleArc))+this.o.min;this.o.stopper&&(f=c(d(f,this.o.max),this.o.min));return f};this.listen=function(){var i=this,h=function(m){m.preventDefault();var n=m.originalEvent,k=n.detail||n.wheelDeltaX,l=n.detail||n.wheelDeltaY,o=parseInt(i.$.val())+(k>0||l>0?i.o.step:k<0||l<0?-i.o.step:0);if(i.cH&&(i.cH(o)===false)){return}i.val(o)},f,j,g=1,e={37:-i.o.step,38:i.o.step,39:i.o.step,40:-i.o.step};this.$.bind("keydown",function(k){var l=k.keyCode;if(l>=96&&l<=105){l=k.keyCode=l-48}f=parseInt(String.fromCharCode(l));if(isNaN(f)){(l!==13)&&(l!==8)&&(l!==9)&&(l!==189)&&k.preventDefault();if(a.inArray(l,[37,38,39,40])>-1){k.preventDefault();var m=parseInt(i.$.val())+e[l]*g;i.o.stopper&&(m=c(d(m,i.o.max),i.o.min));i.change(m);i._draw();j=window.setTimeout(function(){g*=2},30)}}}).bind("keyup",function(k){if(isNaN(f)){if(j){window.clearTimeout(j);j=null;g=1;i.val(i.$.val())}}else{(i.$.val()>i.o.max&&i.$.val(i.o.max))||(i.$.val()<i.o.min&&i.$.val(i.o.min))}});this.$c.bind("mousewheel DOMMouseScroll",h);this.$.bind("mousewheel DOMMouseScroll",h)};this.init=function(){if(this.v<this.o.min||this.v>this.o.max){this.v=this.o.min}this.$.val(this.v);this.w2=this.o.width/2;this.cursorExt=this.o.cursor/100;this.xy=this.w2;this.lineWidth=this.xy*this.o.thickness;this.lineCap=this.o.lineCap;this.radius=this.xy-this.lineWidth/2;this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset);this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc);this.angleOffset=this.o.angleOffset*Math.PI/180;this.angleArc=this.o.angleArc*Math.PI/180;this.startAngle=1.5*Math.PI+this.angleOffset;this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=c(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:((this.o.width/2+4)>>0)+"px",height:((this.o.width/3)>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":((this.o.width/3)>>0)+"px","margin-left":"-"+((this.o.width*3/4+2)>>0)+"px",border:0,background:"none",font:"bold "+((this.o.width/e)>>0)+"px Arial","text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})};this.change=function(e){this.cv=e;this.$.val(e)};this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)};this.draw=function(){var f=this.g,e=this.angle(this.cv),k=this.startAngle,h=k+e,j,g,i=1;f.lineWidth=this.lineWidth;f.lineCap=this.lineCap;this.o.cursor&&(k=h-this.cursorExt)&&(h=h+this.cursorExt);f.beginPath();f.strokeStyle=this.o.bgColor;f.arc(this.xy,this.xy,this.radius,this.endAngle,this.startAngle,true);f.stroke();if(this.o.displayPrevious){g=this.startAngle+this.angle(this.v);j=this.startAngle;this.o.cursor&&(j=g-this.cursorExt)&&(g=g+this.cursorExt);f.beginPath();f.strokeStyle=this.pColor;f.arc(this.xy,this.xy,this.radius,j,g,false);f.stroke();i=(this.cv==this.v)}f.beginPath();f.strokeStyle=i?this.o.fgColor:this.fgColor;f.arc(this.xy,this.xy,this.radius,k,h,false);f.stroke()};this.cancel=function(){this.val(this.v)}};a.fn.dial=a.fn.knob=function(e){return this.each(function(){var f=new b.Dial();f.o=e;f.$=a(this);f.run()}).parent()}})(jQuery);